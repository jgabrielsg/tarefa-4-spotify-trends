import{n as Z,a as T,d as Et,t as W,h as Lt}from"../chunks/adE62cOG.js";import"../chunks/CZnUrueR.js";import{aH as Vt,u as Ot,aC as Pt,A as Ut,af as _t,az as Ht,e as v,m as S,v as vt,aA as Ft,aj as $,ak as D,ah as P,b as e,al as M,ag as at,a as xt,ai as wt,$ as Qt}from"../chunks/DwaHF2ox.js";import{l as Yt,e as j,s as U}from"../chunks/COC0GgQg.js";import{i as K}from"../chunks/keVY0Til.js";import{s as _,e as et,r as V,i as Zt}from"../chunks/Bvzhq18T.js";import{i as kt}from"../chunks/D5bG9PrA.js";import{c as Gt,o as Jt}from"../chunks/CkYU9YMT.js";import{p as gt}from"../chunks/BoT9xMRc.js";import"../chunks/fwNpjDEC.js";function O(t,a,r=a){var n=Vt();Yt(t,"input",l=>{var o=l?t.defaultValue:t.value;if(o=ut(t)?ft(o):o,r(o),n&&o!==(o=a())){var c=t.selectionStart,h=t.selectionEnd;t.value=o??"",h!==null&&(t.selectionStart=c,t.selectionEnd=Math.min(h,t.value.length))}}),(Ut&&t.defaultValue!==t.value||Ot(a)==null&&t.value)&&r(ut(t)?ft(t.value):t.value),Pt(()=>{var l=a();ut(t)&&l===ft(t.value)||t.type==="date"&&!l&&!t.value||l!==t.value&&(t.value=l??"")})}function ut(t){var a=t.type;return a==="number"||a==="range"}function ft(t){return t===""?null:+t}class Kt extends Map{constructor(a,r=te){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),a!=null)for(const[n,l]of a)this.set(n,l)}get(a){return super.get(mt(this,a))}has(a){return super.has(mt(this,a))}set(a,r){return super.set(Wt(this,a),r)}delete(a){return super.delete(Xt(this,a))}}function mt({_intern:t,_key:a},r){const n=a(r);return t.has(n)?t.get(n):r}function Wt({_intern:t,_key:a},r){const n=a(r);return t.has(n)?t.get(n):(t.set(n,r),r)}function Xt({_intern:t,_key:a},r){const n=a(r);return t.has(n)&&(r=t.get(n),t.delete(n)),r}function te(t){return t!==null&&typeof t=="object"?t.valueOf():t}function yt(t){return t}function ee(t,...a){return ae(t,yt,yt,a)}function ae(t,a,r,n){return function l(o,c){if(c>=n.length)return r(o);const h=new Kt,p=n[c++];let x=-1;for(const d of o){const k=p(d,++x,o),s=h.get(k);s?s.push(d):h.set(k,[d])}for(const[d,k]of h)h.set(d,l(k,c));return a(h)}(t,0)}function re(t){var a=0,r=t.children,n=r&&r.length;if(!n)a=1;else for(;--n>=0;)a+=r[n].value;t.value=a}function ne(){return this.eachAfter(re)}function ie(t,a){let r=-1;for(const n of this)t.call(a,n,++r,this);return this}function se(t,a){for(var r=this,n=[r],l,o,c=-1;r=n.pop();)if(t.call(a,r,++c,this),l=r.children)for(o=l.length-1;o>=0;--o)n.push(l[o]);return this}function le(t,a){for(var r=this,n=[r],l=[],o,c,h,p=-1;r=n.pop();)if(l.push(r),o=r.children)for(c=0,h=o.length;c<h;++c)n.push(o[c]);for(;r=l.pop();)t.call(a,r,++p,this);return this}function oe(t,a){let r=-1;for(const n of this)if(t.call(a,n,++r,this))return n}function ce(t){return this.eachAfter(function(a){for(var r=+t(a.data)||0,n=a.children,l=n&&n.length;--l>=0;)r+=n[l].value;a.value=r})}function ue(t){return this.eachBefore(function(a){a.children&&a.children.sort(t)})}function fe(t){for(var a=this,r=he(a,t),n=[a];a!==r;)a=a.parent,n.push(a);for(var l=n.length;t!==r;)n.splice(l,0,t),t=t.parent;return n}function he(t,a){if(t===a)return t;var r=t.ancestors(),n=a.ancestors(),l=null;for(t=r.pop(),a=n.pop();t===a;)l=t,t=r.pop(),a=n.pop();return l}function de(){for(var t=this,a=[t];t=t.parent;)a.push(t);return a}function pe(){return Array.from(this)}function ve(){var t=[];return this.eachBefore(function(a){a.children||t.push(a)}),t}function ge(){var t=this,a=[];return t.each(function(r){r!==t&&a.push({source:r.parent,target:r})}),a}function*me(){var t=this,a,r=[t],n,l,o;do for(a=r.reverse(),r=[];t=a.pop();)if(yield t,n=t.children)for(l=0,o=n.length;l<o;++l)r.push(n[l]);while(r.length)}function ht(t,a){t instanceof Map?(t=[void 0,t],a===void 0&&(a=xe)):a===void 0&&(a=_e);for(var r=new rt(t),n,l=[r],o,c,h,p;n=l.pop();)if((c=a(n.data))&&(p=(c=Array.from(c)).length))for(n.children=c,h=p-1;h>=0;--h)l.push(o=c[h]=new rt(c[h])),o.parent=n,o.depth=n.depth+1;return r.eachBefore(ke)}function ye(){return ht(this).eachBefore(we)}function _e(t){return t.children}function xe(t){return Array.isArray(t)?t[1]:null}function we(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function ke(t){var a=0;do t.height=a;while((t=t.parent)&&t.height<++a)}function rt(t){this.data=t,this.depth=this.height=0,this.parent=null}rt.prototype=ht.prototype={constructor:rt,count:ne,each:ie,eachAfter:le,eachBefore:se,find:oe,sum:ce,sort:ue,path:fe,ancestors:de,descendants:pe,leaves:ve,links:ge,copy:ye,[Symbol.iterator]:me};function be(t){if(typeof t!="function")throw new Error;return t}function G(){return 0}function J(t){return function(){return t}}function Ie(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function Me(t,a,r,n,l){for(var o=t.children,c,h=-1,p=o.length,x=t.value&&(n-a)/t.value;++h<p;)c=o[h],c.y0=r,c.y1=l,c.x0=a,c.x1=a+=c.value*x}function Ae(t,a,r,n,l){for(var o=t.children,c,h=-1,p=o.length,x=t.value&&(l-r)/t.value;++h<p;)c=o[h],c.x0=a,c.x1=n,c.y0=r,c.y1=r+=c.value*x}var De=(1+Math.sqrt(5))/2;function Be(t,a,r,n,l,o){for(var c=[],h=a.children,p,x,d=0,k=0,s=h.length,w,b,m=a.value,f,i,y,A,g,I,B;d<s;){w=l-r,b=o-n;do f=h[k++].value;while(!f&&k<s);for(i=y=f,I=Math.max(b/w,w/b)/(m*t),B=f*f*I,g=Math.max(y/B,B/i);k<s;++k){if(f+=x=h[k].value,x<i&&(i=x),x>y&&(y=x),B=f*f*I,A=Math.max(y/B,B/i),A>g){f-=x;break}g=A}c.push(p={value:f,dice:w<b,children:h.slice(d,k)}),p.dice?Me(p,r,n,l,m?n+=b*f/m:o):Ae(p,r,n,m?r+=w*f/m:l,o),m-=f,d=k}return c}const Re=function t(a){function r(n,l,o,c,h){Be(a,n,l,o,c,h)}return r.ratio=function(n){return t((n=+n)>1?n:1)},r}(De);function Se(){var t=Re,a=!1,r=1,n=1,l=[0],o=G,c=G,h=G,p=G,x=G;function d(s){return s.x0=s.y0=0,s.x1=r,s.y1=n,s.eachBefore(k),l=[0],a&&s.eachBefore(Ie),s}function k(s){var w=l[s.depth],b=s.x0+w,m=s.y0+w,f=s.x1-w,i=s.y1-w;f<b&&(b=f=(b+f)/2),i<m&&(m=i=(m+i)/2),s.x0=b,s.y0=m,s.x1=f,s.y1=i,s.children&&(w=l[s.depth+1]=o(s)/2,b+=x(s)-w,m+=c(s)-w,f-=h(s)-w,i-=p(s)-w,f<b&&(b=f=(b+f)/2),i<m&&(m=i=(m+i)/2),t(s,b,m,f,i))}return d.round=function(s){return arguments.length?(a=!!s,d):a},d.size=function(s){return arguments.length?(r=+s[0],n=+s[1],d):[r,n]},d.tile=function(s){return arguments.length?(t=be(s),d):t},d.padding=function(s){return arguments.length?d.paddingInner(s).paddingOuter(s):d.paddingInner()},d.paddingInner=function(s){return arguments.length?(o=typeof s=="function"?s:J(+s),d):o},d.paddingOuter=function(s){return arguments.length?d.paddingTop(s).paddingRight(s).paddingBottom(s).paddingLeft(s):d.paddingTop()},d.paddingTop=function(s){return arguments.length?(c=typeof s=="function"?s:J(+s),d):c},d.paddingRight=function(s){return arguments.length?(h=typeof s=="function"?s:J(+s),d):h},d.paddingBottom=function(s){return arguments.length?(p=typeof s=="function"?s:J(+s),d):p},d.paddingLeft=function(s){return arguments.length?(x=typeof s=="function"?s:J(+s),d):x},d}var $e=Z('<clipPath><rect x="0" y="0"></rect></clipPath>'),Te=Z('<text fill="white" font-size="10" text-anchor="middle" font-weight="bold" style="text-shadow: 0 1px 2px rgba(0,0,0,0.8);"> </text><text fill="#1DB954" font-size="9" text-anchor="middle" style="text-shadow: 0 1px 2px rgba(0,0,0,0.8);"> </text>',1),Ce=Z('<g style="cursor: pointer;"><rect fill="#222" style="transition: all 0.2s ease;"></rect><image preserveAspectRatio="xMidYMid slice"></image><rect style="transition: all 0.2s ease;"></rect><!></g>'),qe=Z('<text y="15" fill="#1DB954" font-size="12" font-weight="bold" text-anchor="middle" style="text-shadow: 0 1px 2px black;"> </text>'),Ne=Z('<g><rect fill="none" stroke="#1DB954" stroke-width="3" style="transition: all 0.3s ease;"></rect><!></g>'),je=Z('<svg xmlns="http://www.w3.org/2000/svg" class="svelte-b2alrm"><defs></defs><!><!></svg>');function ze(t,a){_t(a,!1);let r=gt(a,"data",24,()=>[]),n=gt(a,"limit",8,10),l=S([]),o=S(null),c=S(null);const h=1e3,p=600,x=Gt();function d(f){const i=`https://open.spotify.com/embed/track/${f}`;x("playtrack",i)}function k(f){v(c,f),d(f)}Ht(()=>(vt(r()),vt(n())),()=>{if(r().length>0){const f=r().map(g=>({...g,total_streams:+g.total_streams})).filter(g=>!isNaN(g.total_streams)&&g.total_streams>0).sort((g,I)=>I.total_streams-g.total_streams),i=ee(f,g=>g.artist),y={children:Array.from(i,([g,I])=>({name:g,children:I}))},A=ht(y).sum(g=>g.total_streams).sort((g,I)=>I.value-g.value);Se().size([h,p]).paddingInner(2).paddingOuter(4)(A),v(l,A.leaves().slice(0,n()))}}),Ft(),kt();var s=je();_(s,"width",h),_(s,"height",p);var w=$(s);et(w,5,()=>e(l),f=>f.data.trackId,(f,i)=>{var y=$e(),A=$(y);D(y),P(()=>{_(y,"id",`clip-${e(i).data.trackId}`),_(A,"width",e(i).x1-e(i).x0),_(A,"height",e(i).y1-e(i).y0)}),T(f,y)}),D(w);var b=M(w);et(b,1,()=>e(l),f=>f.data.trackId,(f,i)=>{var y=Ce(),A=$(y),g=M(A),I=M(g),B=M(I);{var L=z=>{var E=Te(),R=at(E),C=$(R,!0);D(R);var q=M(R),H=$(q);D(q),P(F=>{_(R,"x",(e(i).x1-e(i).x0)/2),_(R,"y",(e(i).y1-e(i).y0)/2-5),U(C,e(i).data.title),_(q,"x",(e(i).x1-e(i).x0)/2),_(q,"y",(e(i).y1-e(i).y0)/2+10),U(H,`${F??""} streams`)},[()=>e(i).data.total_streams.toLocaleString()],xt),T(z,E)};K(B,z=>{e(i).x1-e(i).x0>60&&e(i).y1-e(i).y0>40&&z(L)})}D(y),P(()=>{_(y,"transform",`translate(${e(i).x0},${e(i).y0})`),_(y,"clip-path",`url(#clip-${e(i).data.trackId})`),_(A,"width",e(i).x1-e(i).x0),_(A,"height",e(i).y1-e(i).y0),_(A,"stroke",e(o)===e(i).data.trackId||e(c)===e(i).data.trackId?"#1DB954":"#aaa"),_(A,"stroke-width",e(o)===e(i).data.trackId||e(c)===e(i).data.trackId?3:1),_(g,"href",e(i).data.imageUrl),_(g,"width",e(i).x1-e(i).x0),_(g,"height",e(i).y1-e(i).y0),_(I,"width",e(i).x1-e(i).x0),_(I,"height",e(i).y1-e(i).y0),_(I,"fill",e(o)===e(i).data.trackId||e(c)===e(i).data.trackId?"rgba(0,0,0,0.2)":"rgba(0,0,0,0.7)")}),j("mouseover",y,()=>v(o,e(i).data.trackId)),j("mouseout",y,()=>v(o,null)),j("click",y,()=>k(e(i).data.trackId)),T(f,y)});var m=M(b);et(m,1,()=>Array.from(new Set(e(l).map(f=>f.parent))),f=>f.data.name,(f,i)=>{var y=Et(),A=at(y);{var g=I=>{var B=Ne(),L=$(B),z=M(L);{var E=R=>{var C=qe(),q=$(C,!0);D(C),P(()=>{_(C,"x",(e(i).x1-e(i).x0)/2),U(q,e(i).data.name)}),T(R,C)};K(z,R=>{e(i).x1-e(i).x0>100&&e(i).y1-e(i).y0>40&&e(i).children.length>1&&R(E)})}D(B),P(()=>{_(B,"transform",`translate(${e(i).x0},${e(i).y0})`),_(L,"width",e(i).x1-e(i).x0),_(L,"height",e(i).y1-e(i).y0)}),T(I,B)};K(A,I=>{e(i)&&I(g)})}T(f,y)}),D(s),T(t,s),wt()}var Ee=W("<p>Carregando…</p>"),Le=W('<div class="card svelte-10oxxhb"><small> </small><br> <strong> </strong><br> <small> </small> <small> </small></div>'),Ve=W('<div class="chart-container svelte-10oxxhb"><h2>Top Músicas por Streams</h2> <!></div> <div class="grid svelte-10oxxhb"></div>',1),Oe=W('<iframe width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media" style="position: fixed; bottom: 10px; left: 10px;"></iframe>'),Pe=W(`<div class="filters svelte-10oxxhb"><input type="date" placeholder="Data início" class="svelte-10oxxhb"> <input type="date" placeholder="Data fim" class="svelte-10oxxhb"> <input placeholder="Música" class="svelte-10oxxhb"> <input placeholder="Artista" class="svelte-10oxxhb"> <input placeholder="Região" class="svelte-10oxxhb"> <input placeholder="Rank (intervalo '1-50')" class="svelte-10oxxhb"> <input placeholder="Qtd. Músicas" type="number" min="1" class="svelte-10oxxhb"></div> <!> <!>`,1);function ea(t,a){_t(a,!1);let r=S(""),n=S(""),l=S(""),o=S(""),c=S(""),h=S(""),p=S(10),x=S([]),d=S([]),k=S(!1),s=S(""),w;function b(u){return u.split("T")[0]}async function m(){(!e(p)||e(p)<1)&&v(p,1),e(p)>50&&v(p,50),w==null||w.abort(),w=new AbortController,v(k,!0);const u=new URLSearchParams({limit:e(p).toString()});e(r)&&u.set("start",e(r)),e(n)&&u.set("end",e(n)),e(l)&&u.set("title",e(l)),e(o)&&u.set("artist",e(o)),e(c)&&u.set("region",e(c)),e(h)&&u.set("rank",e(h));try{const N=await fs.readFile(new URL("./public/charts.duck.db",import.meta.url));if(res.ok){const Q=await res.json();v(x,Q.data||[]),v(d,Q.graph||[]),console.log("Dados da tabela:",e(x)),console.log("Dados do gráfico:",e(d)),e(x).sort((it,X)=>new Date(it.date)-new Date(X.date))}else v(x,[]),v(d,[])}catch(N){N.name!=="AbortError"&&console.error(N),v(x,[]),v(d,[])}finally{v(k,!1)}}function f(u){v(r,u.target.value),m()}function i(u){v(n,u.target.value),m()}function y(u){v(l,u.target.value),m()}function A(u){v(o,u.target.value),m()}function g(u){v(c,u.target.value),m()}function I(u){v(h,u.target.value),m()}function B(u){v(s,`https://open.spotify.com/embed/track/${u}`)}Jt(m),kt();var L=Pe();Lt(u=>{Qt.title="Charts Top"});var z=at(L),E=$(z);V(E);var R=M(E,2);V(R);var C=M(R,2);V(C);var q=M(C,2);V(q);var H=M(q,2);V(H);var F=M(H,2);V(F);var nt=M(F,2);V(nt),D(z);var dt=M(z,2);{var bt=u=>{var N=Ee();T(u,N)},It=u=>{var N=Ve(),Q=at(N),it=M($(Q),2);ze(it,{get data(){return e(d)},get limit(){return e(p)},$$events:{playtrack:st=>v(s,st.detail)}}),D(Q);var X=M(Q,2);et(X,5,()=>e(x),Zt,(st,Y,Ue,He)=>{let Dt=()=>e(Y).date,Bt=()=>e(Y).rank,Rt=()=>e(Y).title,St=()=>e(Y).artist,$t=()=>e(Y).region,Tt=()=>e(Y).trackId;var tt=Le(),lt=$(tt),Ct=$(lt);D(lt);var ot=M(lt,3),qt=$(ot,!0);D(ot);var ct=M(ot,3),Nt=$(ct);D(ct);var pt=M(ct,2),jt=$(pt,!0);D(pt),D(tt),P(zt=>{U(Ct,`${zt??""} – #${Bt()??""}`),U(qt,Rt()),U(Nt,`${St()??""};`),U(jt,$t())},[()=>b(Dt())],xt),j("click",tt,()=>B(Tt())),T(st,tt)}),D(X),T(u,N)};K(dt,u=>{e(k)?u(bt):u(It,!1)})}var Mt=M(dt,2);{var At=u=>{var N=Oe();P(()=>_(N,"src",e(s))),T(u,N)};K(Mt,u=>{e(s)&&u(At)})}O(E,()=>e(r),u=>v(r,u)),j("input",E,f),O(R,()=>e(n),u=>v(n,u)),j("input",R,i),O(C,()=>e(l),u=>v(l,u)),j("input",C,y),O(q,()=>e(o),u=>v(o,u)),j("input",q,A),O(H,()=>e(c),u=>v(c,u)),j("input",H,g),O(F,()=>e(h),u=>v(h,u)),j("input",F,I),O(nt,()=>e(p),u=>v(p,u)),j("input",nt,m),T(t,L),wt()}export{ea as component};
